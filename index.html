<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Lucidian</title>

<style>
  :root{
    /* tweak these safely */
    --brand-gold: #f2cf66;
    --brand-gold-soft: rgba(242,207,102,.25);
    --bubble-user: rgba(60,64,72,.85);
    --bubble-ai: rgba(240,210,90,.15);
    --ink: #d9dde7;
    --bg-top: #0f1217;
    --bg-deep: #0a1017;
    --ring: rgba(0,0,0,.55);
    --symbol-size: 74px;     /* ‚Üê change 64‚Äì88px to taste */
    --header-h: 84px;        /* header bar height */
    --sidebar-w: 320px;      /* desktop sidebar width */
    --rad: 14px;
    --shadow: 0 8px 30px rgba(0,0,0,.55);
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; margin: 0; background: radial-gradient(1200px 800px at 50% 40%, #113049 0%, #0d2132 40%, var(--bg-deep) 100%); color: var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
  body { overflow: hidden; }

  /* layout */
  .app { position: relative; height: 100%; width: 100%; display: grid; grid-template-rows: var(--header-h) 1fr auto; grid-template-columns: 1fr; }

  /* header */
  .header { position: sticky; top: 0; z-index: 10; background: linear-gradient(180deg, rgba(15,18,23,.95), rgba(15,18,23,.86)); border-bottom: 1px solid rgba(255,255,255,.06); display: grid; grid-template-columns: auto 1fr auto; align-items: center; padding: 0 16px; }
  .profile-toggle { position: relative; z-index: 12; background: rgba(255,255,255,.06); color: var(--ink); border: 1px solid rgba(255,255,255,.12); padding: 8px 10px; border-radius: 10px; cursor: pointer; }
  .brand { display: flex; align-items: center; justify-content: center; font-weight: 800; letter-spacing: .48rem; color: var(--brand-gold); font-size: 32px; }
  .brand-symbol { width: var(--symbol-size); height: var(--symbol-size); min-width: var(--symbol-size); min-height: var(--symbol-size); border-radius: 50%; background: radial-gradient(circle at 50% 50%, rgba(242,207,102,.9), rgba(242,207,102,.35) 40%, rgba(242,207,102,.08) 68%, transparent 70%); box-shadow: 0 0 18px rgba(242,207,102,.55), inset 0 0 18px rgba(242,207,102,.25); margin-left: 10px; background-image: radial-gradient(circle at center, transparent 24%, rgba(0,0,0,.15) 25%), radial-gradient(circle at center, transparent 44%, rgba(0,0,0,.12) 45%); background-blend-mode: overlay; }
  .brand-wrap { display:flex; align-items:center; justify-content:center; }

  .hamburger { display:none; position: absolute; left: 16px; top: 50%; transform: translateY(-50%); z-index: 12; background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); padding: 8px 10px; border-radius: 10px; cursor:pointer; }

  /* stars canvas (instant) */
  #stars { position: absolute; inset: 0 0 0 0; z-index: 0; pointer-events: none; }

  /* main row: sidebar + chat */
  .main { position: relative; display: grid; grid-template-columns: var(--sidebar-w) 1fr; gap: 0; height: 100%; z-index: 1; }

  /* sidebar */
  .sidebar { height: 100%; overflow: hidden; border-right: 1px solid rgba(255,255,255,.06); background: linear-gradient(180deg, rgba(15,18,23,.86), rgba(15,18,23,.66)); padding: 12px; }
  .sidebar-scroll { height: 100%; overflow: auto; padding-right: 4px; }
  .section-label { font-size: 12px; opacity:.75; margin: 8px 4px; }
  .row { display:flex; gap: 8px; align-items:center; margin-bottom: 10px; }
  .btn { background: linear-gradient(180deg, rgba(242,207,102,.95), rgba(242,207,102,.85)); color: #2b2300; border: 0; padding: 10px 14px; border-radius: 12px; font-weight: 700; cursor:pointer; box-shadow: 0 2px 0 rgba(0,0,0,.3); }
  .btn.secondary { background: rgba(255,255,255,.06); color: var(--ink); border: 1px solid rgba(255,255,255,.12); font-weight: 600; }
  .input { flex:1; background: rgba(0,0,0,.25); border: 1px solid rgba(255,255,255,.12); color: var(--ink); padding: 10px 12px; border-radius: 12px; }

  .conv { display:flex; gap: 8px; align-items:center; justify-content: space-between; padding: 8px; border-radius: 10px; background: rgba(0,0,0,.2); border: 1px solid rgba(255,255,255,.06); margin-bottom: 8px; }
  .conv .title { flex:1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .conv .mini { display:flex; gap:6px; }
  .mini .pill { padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,.08); background: rgba(255,255,255,.05); cursor: pointer; }
  .mini .danger { background: rgba(240,70,70,.18); border-color: rgba(240,70,70,.35); color:#ffdada; }

  /* chat */
  .chat-wrap { position: relative; height: 100%; overflow: auto; padding: 18px 18px 110px; }
  .chat { max-width: 1100px; margin: 0 auto; position: relative; }
  .bubble { display:inline-block; max-width: 70%; margin: 10px 12px; padding: 12px 14px; border-radius: 14px; line-height: 1.35; backdrop-filter: blur(3px); position: relative; }
  .ai { background: var(--bubble-ai); border: 1px solid var(--brand-gold-soft); color: var(--ink); align-self: flex-start; }
  .me { background: var(--bubble-user); border: 1px solid rgba(255,255,255,.12); color: var(--ink); align-self: flex-end; }
  .row-bubble { display:flex; }
  .row-bubble.me { justify-content: flex-end; }
  .row-bubble.ai { justify-content: flex-start; }

  /* hover actions */
  .actions { position: absolute; right: -6px; top: -32px; display:flex; gap:6px; opacity:0; pointer-events:none; transition:.12s; }
  .bubble:hover .actions { opacity:1; pointer-events:auto; }
  .action { font-size:12px; padding: 6px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,.12); background: rgba(0,0,0,.45); cursor:pointer; }

  /* composer */
  .composer { position: sticky; bottom: 0; z-index: 10; background: linear-gradient(180deg, rgba(15,18,23,.0), rgba(15,18,23,.9)); border-top: 1px solid rgba(255,255,255,.06); padding: 10px 14px; }
  .composer-row { max-width: 1100px; margin: 0 auto; display:flex; gap: 8px; }
  .composer .btn, .composer .input { height: 44px; }

  /* profile overlay/panel */
  #profile-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.35); backdrop-filter: blur(2px); z-index: 1600; display:none; }
  #profile-panel { position: fixed; top: 82px; left: 16px; width: min(380px, calc(100vw - 32px)); max-height: min(78vh, 900px); overflow:auto; padding:16px; border-radius:12px; background: rgba(20,20,22,.92); border: 1px solid var(--brand-gold-soft); box-shadow: var(--shadow); z-index:1700; display:none; }
  #profile-panel h3 { margin:0 0 10px 0; }
  #profile-panel .field { display:flex; flex-direction:column; gap:6px; margin: 10px 0; }
  #profile-panel .field input, #profile-panel .field select { background: rgba(0,0,0,.25); border: 1px solid rgba(255,255,255,.14); color: var(--ink); padding: 10px 12px; border-radius: 10px; }
  #profile-panel .row { gap:10px; }

  /* library modal */
  #library-modal { position: fixed; inset: 0; z-index: 1500; display:none; align-items: center; justify-content: center; }
  #library-scrim { position:absolute; inset:0; background: rgba(0,0,0,.45); backdrop-filter: blur(2px); }
  #library-card { position: relative; width: min(880px, 92vw); max-height: min(70vh, 800px); overflow:auto; padding:16px; border-radius: 16px; background: rgba(18,19,23,.95); border:1px solid rgba(255,255,255,.12); box-shadow: var(--shadow); }
  .lib-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:12px; }
  .lib-item { border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); border-radius: 12px; padding: 10px; }
  .lib-item a { color: var(--brand-gold); text-decoration: none; }
  .close-x { position:absolute; right:14px; top:12px; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18); border-radius: 10px; padding: 6px 10px; cursor:pointer; }

  /* responsive */
  @media (max-width: 1024px){
    .hamburger { display:block; }
    .main { grid-template-columns: 1fr; }
    .sidebar { position: fixed; z-index: 1200; top: var(--header-h); left: 0; height: calc(100% - var(--header-h)); width: min(86vw, 360px); transform: translateX(-110%); transition: transform .18s; }
    .sidebar.open { transform: translateX(0); }
    .chat-wrap { padding: 16px 12px 100px; }
    .bubble { max-width: 86%; }
  }
</style>
</head>

<body>
<div class="app">
  <!-- Header -->
  <div class="header">
    <button id="hamburger" class="hamburger">‚ò∞</button>
    <button id="profileToggle" class="profile-toggle">kyle ‚ñæ</button>

    <div class="brand-wrap">
      <div class="brand">L U C I D I A N</div>
    </div>

    <div class="brand-symbol" aria-hidden="true"></div>
  </div>

  <!-- Stars (instant) -->
  <canvas id="stars"></canvas>

  <!-- Main -->
  <div class="main">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-scroll">
        <div class="section-label">Profile</div>
        <div class="row">
          <button id="newConv" class="btn" style="flex:1;">New</button>
        </div>

        <div class="row" style="margin-top:14px;">
          <div class="section-label" style="margin:0;">Library</div>
          <button id="openLibrary" class="btn secondary" style="margin-left:auto;">Open</button>
        </div>

        <div class="section-label" style="margin-top:14px;">Search</div>
        <div class="row">
          <input id="searchBox" class="input" placeholder="Search conversations..." />
          <button id="searchGo" class="btn secondary">Go</button>
        </div>

        <div id="convList"></div>
      </div>
    </aside>

    <!-- Chat -->
    <div id="chatWrap" class="chat-wrap">
      <div id="chat" class="chat"></div>
    </div>
  </div>

  <!-- Composer -->
  <div class="composer">
    <div class="composer-row">
      <button id="attach" class="btn secondary">Attach</button>
      <button id="mic" class="btn secondary">üéôÔ∏è Mic</button>
      <input id="msg" class="input" placeholder="Type a message..." />
      <button id="send" class="btn">Send</button>
      <button id="voice" class="btn secondary">Voice</button>
    </div>
  </div>
</div>

<!-- Profile panel + overlay -->
<div id="profile-overlay"></div>
<div id="profile-panel">
  <h3>Profile</h3>
  <div class="field"><label>Name <input id="profName" type="text" value="kyle"></label></div>
  <div class="field"><label>Email <input id="profEmail" type="email" value="kylejenkins2468@gmail.com"></label></div>
  <div class="field"><label>Phone <input id="profPhone" type="tel" value=""></label></div>
  <div class="field"><label>Password <input id="profPass" type="password" value=""></label></div>
  <div class="row">
    <button id="profSave" class="btn">Save</button>
    <button id="profLogout" class="btn secondary">Sign out</button>
  </div>
</div>

<!-- Library modal -->
<div id="library-modal">
  <div id="library-scrim"></div>
  <div id="library-card">
    <button id="libraryClose" class="close-x">Close</button>
    <h3 style="margin:0 0 12px 0;">Shared Library</h3>
    <div id="libraryGrid" class="lib-grid"></div>
  </div>
</div>

<script>
/* -------------- tiny state -------------- */
const state = {
  currentConvId: null,
  conversations: JSON.parse(localStorage.getItem('convs') || '[]'), // [{id,title,items:[{role,text,type,url}]}]
  library: JSON.parse(localStorage.getItem('library') || '[]'),       // [{name,url,ts}]
  profile: JSON.parse(localStorage.getItem('profile') || '{"name":"kyle","email":"kylejenkins2468@gmail.com"}'),
};

const $ = s=>document.querySelector(s);
const el = {
  chat: $('#chat'),
  convList: $('#convList'),
  msg: $('#msg'),
  stars: $('#stars'),
  sidebar: $('#sidebar'),
  hamburger: $('#hamburger'),
  profileToggle: $('#profileToggle'),
  profOverlay: $('#profile-overlay'),
  profPanel: $('#profile-panel'),
  profName: $('#profName'), profEmail: $('#profEmail'), profPhone: $('#profPhone'), profPass: $('#profPass'),
  libraryModal: $('#library-modal'), libraryClose: $('#libraryClose'), libraryScrim: $('#library-scrim'), libraryGrid: $('#libraryGrid'),
};

/* -------------- stars (draw immediately) -------------- */
(function stars(){
  const c = el.stars, ctx = c.getContext('2d');
  function resize(){ c.width = window.innerWidth; c.height = window.innerHeight; }
  resize();
  const stars = Array.from({length: Math.round((c.width*c.height)/16000)}, ()=>({
    x: Math.random()*c.width, y: Math.random()*c.height, z: Math.random()*0.6+0.4, tw: Math.random()*0.6+0.4
  }));
  function tick(){
    ctx.clearRect(0,0,c.width,c.height);
    for(const s of stars){
      const size = s.z*1.8;
      ctx.fillStyle = `rgba(255,255,255,${0.6*s.tw})`;
      ctx.fillRect(s.x, s.y, size, size);
      s.x += 0.03*s.z; if(s.x>c.width+2) s.x = -2;
      s.tw += (Math.random()-.5)*0.02; s.tw = Math.min(1, Math.max(0.2, s.tw));
    }
    requestAnimationFrame(tick);
  }
  window.addEventListener('resize', resize);
  tick();
})();

/* -------------- helpers -------------- */
function save(){ localStorage.setItem('convs', JSON.stringify(state.conversations)); }
function saveLib(){ localStorage.setItem('library', JSON.stringify(state.library)); }
function byId(id){ return state.conversations.find(c=>c.id===id); }
function ensureConv(){
  if(!state.currentConvId){
    const id = crypto.randomUUID();
    state.conversations.unshift({id, title:"New Conversation", items:[]});
    state.currentConvId = id; save();
  }
}

/* -------------- render -------------- */
function renderSidebar(){
  const list = state.conversations.map(c=>{
    return `<div class="conv" data-id="${c.id}">
      <div class="title">${c.title||'New Conversation'}</div>
      <div class="mini">
        <div class="pill select">Select</div>
        <div class="pill danger del">Del</div>
      </div>
    </div>`;
  }).join('');
  el.convList.innerHTML = list;
}

function renderChat(){
  const conv = byId(state.currentConvId);
  el.chat.innerHTML = (conv?.items||[]).map(m=>{
    const side = m.role==='ai' ? 'ai' : 'me';
    const act = `
      <div class="actions">
        <div class="action copy">Copy</div>
        ${side==='me' ? '<div class="action edit">Edit</div>' : ''}
        <div class="action read">Read</div>
      </div>`;
    if(m.type==='file'){
      return `<div class="row-bubble ${side}">
        <div class="bubble ${side}">
          ${act}
          <div><strong>${m.name}</strong></div>
          <div style="margin-top:6px;"><a href="${m.url}" download>Download</a></div>
        </div>
      </div>`;
    }
    return `<div class="row-bubble ${side}">
      <div class="bubble ${side}">
        ${act}
        ${escapeHtml(m.text)}
      </div>
    </div>`;
  }).join('');
  el.chatWrap.scrollTop = el.chatWrap.scrollHeight;
}

function renderLibrary(){
  el.libraryGrid.innerHTML = state.library.map(f=>{
    const date = new Date(f.ts||Date.now()).toLocaleString();
    return `<div class="lib-item">
      <div style="font-size:13px; opacity:.8;">${date}</div>
      <div style="margin:6px 0; font-weight:700;">${escapeHtml(f.name)}</div>
      <a href="${f.url}" download>Download</a>
    </div>`;
  }).join('') || `<div style="opacity:.7;">Nothing shared yet.</div>`;
}

/* -------------- actions -------------- */
function send(text){
  ensureConv();
  const conv = byId(state.currentConvId);
  conv.items.push({role:'me', text});
  save(); renderChat();
  // demo echo
  setTimeout(()=>{
    conv.items.push({role:'ai', text:`Echoing intention: ${text}`});
    save(); renderChat();
  }, 200);
}

function attachDummy(){ // demo attachment
  ensureConv();
  const conv = byId(state.currentConvId);
  const blob = new Blob([new TextEncoder().encode('lucidian demo file')], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const name = 'index.html';
  conv.items.push({role:'me', type:'file', url, name});
  state.library.unshift({name, url, ts: Date.now()});
  save(); saveLib(); renderChat();
}

function escapeHtml(s){
  return (s||'').replace(/[&<>"']/g, ch=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[ch]));
}

/* -------------- event wiring -------------- */
$('#send').addEventListener('click', ()=>{
  const t = el.msg.value.trim(); if(!t) return;
  el.msg.value=''; send(t);
});
el.msg.addEventListener('keydown', e=>{
  if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); $('#send').click(); }
});

$('#attach').addEventListener('click', attachDummy);

/* sidebar controls */
$('#newConv').addEventListener('click', ()=>{
  state.currentConvId = null; ensureConv(); renderSidebar(); renderChat();
});
$('#searchGo').addEventListener('click', ()=>{
  const q = ($('#searchBox').value||'').toLowerCase();
  const match = state.conversations.find(c=> (c.title||'new conversation').toLowerCase().includes(q));
  if(match){ state.currentConvId = match.id; renderSidebar(); renderChat(); }
});
el.convList.addEventListener('click', (e)=>{
  const item = e.target.closest('.conv'); if(!item) return;
  const id = item.dataset.id;
  if(e.target.classList.contains('del')){
    const i = state.conversations.findIndex(c=>c.id===id);
    if(i>-1){ state.conversations.splice(i,1); save(); if(state.currentConvId===id) state.currentConvId=null; ensureConv(); renderSidebar(); renderChat(); }
  }else if(e.target.classList.contains('select') || e.target.classList.contains('title')){
    state.currentConvId = id; renderSidebar(); renderChat();
  }
});

/* bubble hover actions: Copy/Edit/Read */
el.chat.addEventListener('click', async (e)=>{
  const bubble = e.target.closest('.bubble'); if(!bubble) return;
  const row = bubble.parentElement; const isMe = row.classList.contains('me');
  const idx = [...el.chat.querySelectorAll('.bubble')].indexOf(bubble);
  const conv = byId(state.currentConvId); if(!conv) return;
  // map bubble index ‚Üí message index (same order)
  const msg = conv.items.filter(m=>m.type!=='system')[idx];

  if(e.target.classList.contains('copy')){
    const text = msg.type==='file' ? msg.name : msg.text;
    await navigator.clipboard.writeText(text||'');
  }
  if(e.target.classList.contains('edit') && isMe && msg && msg.type!=='file'){
    const newText = prompt('Edit your message:', msg.text||'');
    if(newText!=null){ msg.text = newText; save(); renderChat(); }
  }
  if(e.target.classList.contains('read')){
    const t = msg.type==='file' ? msg.name : msg.text;
    if('speechSynthesis' in window){
      const ut = new SpeechSynthesisUtterance(t||''); ut.rate = 1.0; ut.pitch = 1.0;
      window.speechSynthesis.cancel(); window.speechSynthesis.speak(ut);
    }
  }
});

/* profile open/close/save */
function openProfile(){ el.profOverlay.style.display='block'; el.profPanel.style.display='block'; }
function closeProfile(){ el.profPanel.style.display='none'; el.profOverlay.style.display='none'; }
el.profileToggle.addEventListener('click', (e)=>{ e.stopPropagation(); (el.profPanel.style.display==='block' ? closeProfile() : openProfile()); });
el.profOverlay.addEventListener('click', closeProfile);

$('#profSave').addEventListener('click', ()=>{
  state.profile = { name: el.profName.value, email: el.profEmail.value, phone: el.profPhone.value };
  localStorage.setItem('profile', JSON.stringify(state.profile));
  el.profileToggle.textContent = (state.profile.name||'me') + ' ‚ñæ';
  closeProfile();
});
$('#profLogout').addEventListener('click', ()=>{
  alert('Sign out placeholder (auth wiring not yet connected).');
  closeProfile();
});

/* library modal */
$('#openLibrary').addEventListener('click', ()=>{ renderLibrary(); el.libraryModal.style.display='flex'; });
el.libraryClose.addEventListener('click', ()=>{ el.libraryModal.style.display='none'; });
el.libraryScrim.addEventListener('click', ()=>{ el.libraryModal.style.display='none'; });

/* mobile drawer */
el.hamburger.addEventListener('click', ()=>{ el.sidebar.classList.toggle('open'); });
window.addEventListener('click', (e)=>{ if(window.innerWidth<=1024){ if(!e.target.closest('#sidebar') && !e.target.closest('#hamburger')) el.sidebar.classList.remove('open'); } });

/* init */
(function init(){
  // profile name on button
  el.profileToggle.textContent = (state.profile?.name || 'me') + ' ‚ñæ';
  ensureConv(); renderSidebar(); renderChat();
})();
</script>
</body>
</html>

