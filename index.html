<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="theme-color" content="#000"/>
<title>Lucidian â€” Interface</title>
<style>
:root{
  --accent:#e8c66a; --accentSoft:rgba(232,198,106,.16); --text:#fff;
  --glass:rgba(0,0,0,.35); --glassStrong:rgba(0,0,0,.55);
  --maxw:1200px;
}
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:#000;color:var(--text);font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,sans-serif;overflow-x:hidden}

/* Background / stars */
.space{position:fixed;inset:0;z-index:-2;background:
  radial-gradient(1200px 800px at 70% 30%, rgba(0,120,255,.20), transparent 60%),
  radial-gradient(900px 700px at 20% 70%, rgba(0,200,255,.12), transparent 60%),
  radial-gradient(600px 600px at 50% 50%, rgba(120,180,255,.10), transparent 70%),
  #000}
.stars,.stars:before,.stars:after,.stars2,.stars2:before,.stars2:after{
  position:absolute;content:"";top:-4000px;left:0;right:0;bottom:0;width:2px;height:2px;background:transparent;animation:drift var(--speed,260s) linear infinite}
.stars{--speed:260s;box-shadow:var(--starsA)} .stars:before{transform:translateY(4000px) scale(.95);filter:brightness(.85);box-shadow:var(--starsB)}
.stars:after{transform:translateY(8000px) scale(.9);filter:brightness(.7);box-shadow:var(--starsC)}
.stars2{--speed:305s;box-shadow:var(--starsD)} .stars2:before{transform:translateY(4000px) scale(.95);filter:brightness(.9);box-shadow:var(--starsE)}
.stars2:after{transform:translateY(8000px) scale(.9);filter:brightness(.75);box-shadow:var(--starsF)}
@keyframes drift{from{transform:translateY(0)}to{transform:translateY(4000px)}}
.nebula{position:absolute;inset:-10%;z-index:-1;background:
  radial-gradient(60% 50% at 60% 40%, rgba(90,150,255,.15), transparent 70%),
  radial-gradient(50% 45% at 30% 65%, rgba(120,220,255,.12), transparent 70%);
  filter:blur(30px) saturate(120%);animation:breathe 18s ease-in-out infinite}
@keyframes breathe{0%,100%{transform:translateY(0)}50%{transform:translateY(1.5%)}}

/* App layout */
.app{min-height:100svh;display:grid;grid-template-rows:auto 1fr auto}

/* Header: crest centered, name under */
header{position:sticky;top:0;z-index:20;text-align:center;padding:14px 12px 6px;background:var(--glassStrong);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.12)}
.hamburger{position:absolute;left:12px;top:10px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);color:#fff;border-radius:8px;padding:8px 10px;cursor:pointer;display:none}
.crest{width:92px;margin:0 auto}
.crest svg{width:100%;height:auto;display:block;filter:drop-shadow(0 0 10px rgba(232,198,106,.45))}
.crest path{fill:none;stroke:var(--accent);stroke-width:1.8;stroke-linecap:round}
.crest .glow{stroke:rgba(232,198,106,.35);stroke-width:4;filter:blur(1px)}
h1{margin:6px 0 0;letter-spacing:8px;font-size:1.25rem;color:var(--accent);text-shadow:0 0 12px rgba(232,198,106,.45);font-weight:700}

/* Content: left sidebar + free chat area */
.content{max-width:var(--maxw);margin:8px auto 0;padding:0 16px;display:grid;grid-template-columns:300px 1fr;gap:14px;min-height:0}
@media(max-width:900px){.content{grid-template-columns:1fr}}
.sidebar{
  background:var(--glassStrong);backdrop-filter:blur(8px);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.15);
  overflow:auto;min-height:0
}
@media(max-width:900px){
  .hamburger{display:block}
  .sidebar{position:fixed;z-index:30;left:0;top:0;bottom:0;width:86vw;transform:translateX(-100%);transition:.2s ease;box-shadow:8px 0 30px rgba(0,0,0,.6)}
  .sidebar.open{transform:none}
  .shade.show{display:block}
}
.shade{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:25;display:none}

.search{display:flex;gap:8px}
.search input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.10);color:#fff}
.search button{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.10);color:#fff;cursor:pointer}
.new-chat{padding:10px;border:none;border-radius:8px;background:var(--accent);color:#000;font-weight:700;cursor:pointer}
.list{overflow:auto;border:1px solid rgba(255,255,255,.15);border-radius:10px;background:rgba(255,255,255,.06)}
.conv{padding:10px;border-bottom:1px solid rgba(255,255,255,.08);display:flex;justify-content:space-between;gap:8px}
.conv.active{background:rgba(255,255,255,.12)}
.conv .select{border:none;border-radius:6px;padding:4px 8px;background:var(--accent);color:#000;cursor:pointer}

/* Chat area = only bubbles */
.chatArea{min-height:0;display:flex;flex-direction:column}
.msgs{flex:1;overflow:auto;padding:8px 8px 14vh; /* extra pad so bubbles never hide under footer */}
.message{
  max-width:min(780px,92%); padding:12px 16px; margin:10px 0; border-radius:12px; line-height:1.45;
  background:rgba(255,255,255,.10); backdrop-filter:blur(2px);
  /* keep long strings inside bubble */
  white-space:pre-wrap; word-break:break-word; overflow-wrap:anywhere;
}
.message.lucidian{border:1px solid var(--accent);color:var(--accent);background:var(--accentSoft);box-shadow:0 0 12px rgba(232,198,106,.18); margin-right:auto; text-align:left}
.message.user{border:1px solid rgba(255,255,255,.7);color:#fff; margin-left:auto; text-align:right}

/* Footer pinned */
footer{position:sticky;bottom:0;z-index:20;background:var(--glassStrong);backdrop-filter:blur(8px);border-top:1px solid rgba(255,255,255,.12)}
.footerInner{max-width:var(--maxw);margin:0 auto;padding:10px 16px}
.row{display:flex;gap:8px;align-items:center;width:100%}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.10);color:#fff;cursor:pointer;white-space:nowrap}
.btn.primary{background:var(--accent);color:#000;border:none;font-weight:700}
input[type=text]{flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.10);color:#fff}

/* Voice modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:40}
.modal.open{display:flex}
.card{width:min(720px,92vw);background:var(--glassStrong);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.2);border-radius:16px;padding:16px}
.card h2{margin:0 0 8px;color:var(--accent)}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
.wave{height:84px;background:rgba(255,255,255,.08);border-radius:10px;position:relative;overflow:hidden}
.bar{position:absolute;bottom:0;width:6px;background:var(--accent);left:0;animation:bars 1s ease-in-out infinite}
@keyframes bars{0%,100%{height:15%}50%{height:85%}}
</style>
</head>
<body>
<div class="space"><div class="stars"></div><div class="stars2"></div><div class="nebula"></div></div>

<div class="app">
  <!-- HEADER -->
  <header>
    <button class="hamburger" id="hamburger">â˜°</button>
    <div class="crest" aria-label="Lucidian Crest">
      <!-- Crest you liked: gold circle + 24 rotated petals -->
      <svg viewBox="0 0 200 200" role="img" xmlns="http://www.w3.org/2000/svg">
        <circle class="glow" cx="100" cy="100" r="86" />
        <g transform="translate(100,100)">
          <defs>
            <path id="petal" d="M0,-80 C22,-80 40,-62 40,-40 C40,-18 22,0 0,0 C-22,0 -40,-18 -40,-40 C-40,-62 -22,-80 0,-80 Z" />
          </defs>
          <g opacity="0.95">
            <use href="#petal" transform="rotate(0)"/><use href="#petal" transform="rotate(15)"/><use href="#petal" transform="rotate(30)"/>
            <use href="#petal" transform="rotate(45)"/><use href="#petal" transform="rotate(60)"/><use href="#petal" transform="rotate(75)"/>
            <use href="#petal" transform="rotate(90)"/><use href="#petal" transform="rotate(105)"/><use href="#petal" transform="rotate(120)"/>
            <use href="#petal" transform="rotate(135)"/><use href="#petal" transform="rotate(150)"/><use href="#petal" transform="rotate(165)"/>
            <use href="#petal" transform="rotate(180)"/><use href="#petal" transform="rotate(195)"/><use href="#petal" transform="rotate(210)"/>
            <use href="#petal" transform="rotate(225)"/><use href="#petal" transform="rotate(240)"/><use href="#petal" transform="rotate(255)"/>
            <use href="#petal" transform="rotate(270)"/><use href="#petal" transform="rotate(285)"/><use href="#petal" transform="rotate(300)"/>
            <use href="#petal" transform="rotate(315)"/><use href="#petal" transform="rotate(330)"/><use href="#petal" transform="rotate(345)"/>
          </g>
        </g>
      </svg>
    </div>
    <h1>LUCIDIAN</h1>
  </header>

  <!-- CLICKâ€‘OUTSIDE SHADE for the drawer -->
  <div class="shade" id="shade"></div>

  <!-- CONTENT -->
  <div class="content">
    <!-- Left conversations -->
    <aside class="sidebar" id="sidebar">
      <div class="search">
        <input id="search" type="text" placeholder="Search conversations..."/>
        <button id="searchBtn">Go</button>
        <button class="new-chat" id="newChat">New</button>
      </div>
      <div class="list" id="convList"></div>
    </aside>

    <!-- Chat area with only bubbles -->
    <section class="chatArea">
      <div class="msgs" id="msgs"></div>
    </section>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="footerInner">
      <div class="row">
        <label class="btn" for="file">ðŸ“Ž Attach</label>
        <input id="file" type="file" multiple hidden/>
        <button class="btn" id="mic" title="Dictate (stays on until you stop)">ðŸŽ¤ Mic</button>
        <input id="text" type="text" placeholder="Type a message..."/>
        <button class="btn primary" id="send">Send</button>
        <button class="btn" id="voiceStudio" title="Open Voice Call">Voice</button>
      </div>
    </div>
  </footer>
</div>

<!-- Voice Call Modal -->
<div class="modal" id="modal">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <h2>Lucidian â€” Voice Call</h2>
      <button class="btn" id="closeModal">Close</button>
    </div>
    <div class="controls">
      <button class="btn primary" id="callToggle">Start call</button>
    </div>
    <div class="wave" id="wave"></div>
    <p style="opacity:.8;margin-top:8px">While call is on: your mic transcribes and autoâ€‘sends on pauses; Lucidian speaks replies.</p>
  </div>
</div>

<script>
/* Stars */
function r(n){return Math.floor(Math.random()*n)}
function stars(n){const a=[];for(let i=0;i<n;i++){const x=r(2000)+"px "+r(4000)+"px ";const c=Math.random();const col=c>.7?'#fff':(c>.4?'#dfe9ff':'#bcd8ff');a.push(x+col)}return a.join(', ')}
const root=document.documentElement;
root.style.setProperty('--starsA',stars(220));
root.style.setProperty('--starsB',stars(220));
root.style.setProperty('--starsC',stars(220));
root.style.setProperty('--starsD',stars(260));
root.style.setProperty('--starsE',stars(260));
root.style.setProperty('--starsF',stars(260));

/* Elements */
const msgs=document.getElementById('msgs'), input=document.getElementById('text'), file=document.getElementById('file');
const send=document.getElementById('send'), mic=document.getElementById('mic');
const convList=document.getElementById('convList'), newChat=document.getElementById('newChat');
const search=document.getElementById('search'), searchBtn=document.getElementById('searchBtn');
const voiceStudio=document.getElementById('voiceStudio'), sidebar=document.getElementById('sidebar');
const hamburger=document.getElementById('hamburger'), shade=document.getElementById('shade');

/* Drawer helpers */
const openSidebar=()=>{ sidebar.classList.add('open'); shade.classList.add('show'); };
const closeSidebar=()=>{ sidebar.classList.remove('open'); shade.classList.remove('show'); };
hamburger&&(hamburger.onclick=()=> sidebar.classList.contains('open') ? closeSidebar() : openSidebar());
shade.onclick=closeSidebar;
document.addEventListener('keydown',e=>{ if(e.key==='Escape'){ closeSidebar(); modal.classList.remove('open'); stopCall(); }});

/* Conversations */
let conversations=JSON.parse(localStorage.getItem('lucidian_convs')||'[]');
let activeId=localStorage.getItem('lucidian_active')||null;
function save(){localStorage.setItem('lucidian_convs',JSON.stringify(conversations))}
function setActive(id){activeId=id;localStorage.setItem('lucidian_active',id);list();render();if(window.innerWidth<900)closeSidebar();}
function createConversation(){const id=Date.now().toString();conversations.unshift({id,title:'New Conversation',messages:[{role:'lucidian',text:'Hello, Ky.'}]});save();setActive(id)}
function bubble(role,text){const d=document.createElement('div');d.className='message '+(role==='user'?'user':'lucidian');d.textContent=text;msgs.appendChild(d);msgs.scrollTop=msgs.scrollHeight}
function render(){msgs.innerHTML='';const c=conversations.find(x=>x.id===activeId);if(!c)return;c.messages.forEach(m=>bubble(m.role,m.text))}
function list(filter=''){convList.innerHTML='';conversations.filter(c=>c.title.toLowerCase().includes(filter.toLowerCase())||c.messages.some(m=>m.text.toLowerCase().includes(filter.toLowerCase()))).forEach(c=>{const line=document.createElement('div');line.className='conv'+(c.id===activeId?' active':'');const span=document.createElement('span');span.textContent=c.title;span.style.flex='1';const sel=document.createElement('button');sel.className='select';sel.textContent='Select';sel.onclick=()=>setActive(c.id);line.appendChild(span);line.appendChild(sel);convList.appendChild(line)})}
function add(role,text){const c=conversations.find(x=>x.id===activeId);if(!c)return;c.messages.push({role,text});if(c.title==='New Conversation'&&role==='user'&&text.trim()){c.title=text.slice(0,42)+(text.length>42?'â€¦':'')}save();render()}

/* Echo reply (placeholder) */
async function reply(userText){const chunks=["Echoing ","intention: ",userText||'listening.'];const c=conversations.find(x=>x.id===activeId);if(!c)return;let last=c.messages[c.messages.length-1];if(!(last&&last.role==='lucidian')){c.messages.push({role:'lucidian',text:''});last=c.messages[c.messages.length-1]}for(const ch of chunks){last.text+=ch;save();render();await new Promise(res=>setTimeout(res,55))}if(callActive&&'speechSynthesis'in window){speechSynthesis.cancel();speechSynthesis.speak(new SpeechSynthesisUtterance(last.text))}}

/* Send */
send.onclick=async ()=>{const t=input.value.trim();if(!t)return;add('user',t);input.value='';await reply(t)}
input.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send.click()}})

/* Search + New */
newChat.onclick=createConversation; searchBtn.onclick=()=>list(search.value);
search.addEventListener('keydown',e=>{if(e.key==='Enter'){list(search.value)}});

/* Mic (stays on until you stop; fills input only) */
let SR=null, rec=null, micActive=false;
function ensureSR(){if(SR===null){SR=window.SpeechRecognition||window.webkitSpeechRecognition||null}return SR}
function startMic(){
  const R=ensureSR(); if(!R){alert('Speech Recognition not supported in this browser. Use Chrome or Edge.');return}
  rec=new R(); rec.lang='en-US'; rec.interimResults=false; rec.continuous=true;
  micActive=true; mic.textContent='â–  Stop';
  rec.onresult=e=>{const t=e.results[e.results.length-1][0].transcript||''; input.value=t.trim()};
  rec.onend=()=>{ if(micActive){ try{rec.start()}catch{} } else { mic.textContent='ðŸŽ¤ Mic' } };
  rec.start();
}
function stopMic(){ micActive=false; try{rec&&rec.stop()}catch{} mic.textContent='ðŸŽ¤ Mic' }
mic.onclick=()=>{ micActive ? stopMic() : startMic() };

/* Voice Call (twoâ€‘way, autoâ€‘send) */
const modal=document.getElementById('modal'), callToggle=document.getElementById('callToggle'), closeModal=document.getElementById('closeModal'), wave=document.getElementById('wave');
voiceStudio.onclick=()=>{ modal.classList.add('open') };
closeModal.onclick=()=>{ modal.classList.remove('open'); stopCall() };
for(let i=0;i<70;i++){const b=document.createElement('div');b.className='bar';b.style.left=(i*10)+'px';b.style.animationDelay=(Math.random()*1)+'s';wave.appendChild(b)}
let callActive=false, callRec=null;
function startCall(){const R=ensureSR(); if(!R){alert('Speech Recognition not supported in this browser. Use Chrome or Edge.');return}
  callActive=true; callToggle.textContent='Stop call'; callRec=new R(); callRec.lang='en-US'; callRec.interimResults=true; callRec.continuous=true;
  callRec.onresult=e=>{let final=''; for(let i=e.resultIndex;i<e.results.length;i++){const r=e.results[i]; if(r.isFinal) final+=r[0].transcript} final=final.trim(); if(final){ add('user',final); reply(final); } };
  callRec.onend=()=>{ if(callActive){ try{callRec.start()}catch{} } };
  speechSynthesis.cancel(); callRec.start();
}
function stopCall(){ callActive=false; callToggle.textContent='Start call'; try{callRec&&callRec.stop()}catch{} speechSynthesis.cancel(); }
callToggle.onclick=()=> callActive ? stopCall() : startCall();

/* PWA */
if('serviceWorker'in navigator){const sw=`self.addEventListener('install',e=>{self.skipWaiting();e.waitUntil(caches.open('lucidian-ui').then(c=>c.addAll(['./'])))});self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))})`;const blob=new Blob([sw],{type:'text/javascript'});navigator.serviceWorker.register(URL.createObjectURL(blob))}
const manifest={name:'Lucidian',short_name:'Lucidian',start_url:'./',display:'standalone',background_color:'#000',theme_color:'#000',icons:[]};
const mBlob=new Blob([JSON.stringify(manifest)],{type:'application/json'});const mUrl=URL.createObjectURL(mBlob);const link=document.createElement('link');link.rel='manifest';link.href=mUrl;document.head.appendChild(link);

/* Boot */
if(!conversations.length){createConversation()}else{if(!activeId){activeId=conversations[0].id}list();render()}
</script>
</body>
</html>
